<!Doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>五子棋</title>
	<style>
		body {
			text-align: center;
		}

		canvas {
			border: 3px solid;
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%,-50%);
		}
	</style>
</head>
<body>
	<!-- <h1>五子棋</h1> -->
	<canvas id="gameBoard" width="700" height="700"></canvas>
	<script>
		const gameSize = 8;
		let intersectPoint = [];
		let black = true;

		let game = document.getElementById("gameBoard");
		let pen = game.getContext("2d");

		function init() {
			drawGame();
			detectClick();
		}

		function drawGame() {
			let currentIndex = 0;
			for (let i=0;i<gameSize;i++) { // draw the rows first
				currentIndex += game.width/gameSize;
				pen.moveTo(currentIndex,0);
				pen.lineTo(currentIndex,game.height);
				pen.stroke();
			}
			currentIndex = 0; // reset currentIndex to 0

			for (let i=0;i<gameSize;i++) { // then draw the columns
				currentIndex += game.height/gameSize;
				pen.moveTo(0,currentIndex);
				pen.lineTo(game.width,currentIndex);
				pen.stroke();
			}
			game.style.backgroundColor = "rgb(212,163,123)"; // set the background color

			let currentX = 0;
			for (let r=0;r<gameSize+1;r++) {
				intersectPoint.push([]);
				let currentY = 0;
				for (let c=0;c<gameSize+1;c++) {
					intersectPoint[r].push({});
					intersectPoint[r][c].x = currentX;
					intersectPoint[r][c].y = currentY;
					intersectPoint[r][c].chess = 0;
					currentY += game.height/gameSize;
				}
				currentX += game.width/gameSize;
			}
		}

		function detectClick() {
			let windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
			let windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
			window.addEventListener("resize",function() {
				windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
				windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
			})

			game.addEventListener("click", function(e) {
				// get mouse click position
				const mouseX = e.pageX;
				const mouseY = e.pageY;

				let clickPosition = {x:mouseX-((windowWidth-game.width)/2),y:mouseY-((windowHeight-game.height)/2)};

				rowLoop:for (let r=0;r<gameSize+1;r++) {
					for (let c=0;c<gameSize+1;c++) {
						if (clickPosition.x - intersectPoint[r][c].x < game.width/gameSize/2 && clickPosition.y - intersectPoint[r][c].y < game.height/gameSize/2) {
							if (intersectPoint[r][c].chess == 0) {
								pen.beginPath();
								pen.arc(intersectPoint[r][c].x,intersectPoint[r][c].y, 30, 0, 2 * Math.PI);
								// pen.stroke();
								if (black) {
									pen.fillStyle = "black";
									intersectPoint[r][c].chess = 1;
									checkWin(r,c);
									black = false;
								} else {
									pen.fillStyle = "white";
									intersectPoint[r][c].chess = 2;
									checkWin(r,c);
									black = true;
								}
								pen.fill()
								console.log(intersectPoint);
								break rowLoop;
							} else {
								return;
							}
						}
					}
				}
			})
		}

		function checkWin(r,c) {
			// let win = true;
			if (black) {
				if (r+4 <= gameSize) {
					if (intersectPoint[r+1][c].chess == 1 && intersectPoint[r+2][c].chess == 1 && intersectPoint[r+3][c].chess == 1 && intersectPoint[r+4][c].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (r+3 <= gameSize && r-1 >= 0) {
					if (intersectPoint[r-1][c].chess == 1 && intersectPoint[r+1][c].chess == 1 && intersectPoint[r+2][c].chess == 1 && intersectPoint[r+3][c].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (r+2 <= gameSize && r-2 >= 0) {
					if (intersectPoint[r-2][c].chess == 1 && intersectPoint[r-1][c].chess == 1 && intersectPoint[r+1][c].chess == 1 && intersectPoint[r+2][c].chess == 1) {
						alert("Black won!");
						return;
					}
				} if (r+1 <= gameSize && r-3 >= 0) {
					if (intersectPoint[r-3][c].chess == 1 && intersectPoint[r-2][c].chess == 1 && intersectPoint[r+1][c].chess == 1 && intersectPoint[r+1][c].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (r-4 >= 0) {
					if (intersectPoint[r-4][c].chess == 1 && intersectPoint[r-3][c].chess == 1 && intersectPoint[r-2][c].chess == 1 && intersectPoint[r-1][c].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (c+4 <= gameSize) {
					if (intersectPoint[r][c+1].chess == 1 && intersectPoint[r][c+2].chess == 1 && intersectPoint[r][c+3].chess == 1 && intersectPoint[r][c+4].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (c+3 <= gameSize && c-1 >= 0) {
					if (intersectPoint[r][c-1].chess == 1 && intersectPoint[r][c+1].chess == 1 && intersectPoint[r][c+2].chess == 1 && intersectPoint[r][c+3].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (c+2 <= gameSize && c-2 >= 0) {
					if (intersectPoint[r][c-2].chess == 1 && intersectPoint[r][c-1].chess == 1 && intersectPoint[r][c+1].chess == 1 && intersectPoint[r][c+2].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (c+1 <= gameSize && c-3 >= 0) {
					if (intersectPoint[r][c-3].chess == 1 && intersectPoint[r][c-2].chess == 1 && intersectPoint[r][c-1].chess == 1 && intersectPoint[r][c+1].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (c-4 >= 0) {
					if (intersectPoint[r][c-4].chess == 1 && intersectPoint[r][c-3].chess == 1 && intersectPoint[r][c-2].chess == 1 && intersectPoint[r][c-1].chess == 1) {
						alert("Black won!");
						return;
					} 
				} if (r+4 <= gameSize && c+4 <= gameSize) {
					if (intersectPoint[r+1][c+1].chess == 1 && intersectPoint[r+2][c+2].chess == 1 && intersectPoint[r+3][c+3].chess == 1 && intersectPoint[r+4][c+4].chess == 1) {
						alert("Black won!");
						return;
					} 
				} 
			}
		}
		
		init();
	</script>
</body>
</html>
